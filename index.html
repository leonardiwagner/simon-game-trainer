<html ng-app="angularApp">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="main.css" />
    <script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.13/angular.js"></script>
    <script src="underscore.js"></script>
  </head>
	<body ng-controller="MainController">
   

    <article class="buttons-container">
      <div ng-repeat="button in buttons" on-repeat-render="renderButtons()" class="button button-{{button.name}}" ng-click="clickGenius(button.name)"></div>
      <div id="score">{{breadcrumb.length}}</div>
    </article>


   

    

    <a href ng-click="runGenius(0)">Run Genius</a>
    <a href ng-click="nextGenius()">Next Genius</a>
    <a href ng-click="pressButton()">Press Button</a>
    <script src="effects.js"></script>
    <script>
      angular.module('angularApp', [])
      .directive('onRepeatRender', function(){
        return {
          restrict: 'A',
          link: function(scope, element, attr){
            if(scope.$last){
                scope.$evalAsync(attr.onRepeatRender);
            }
          }
        }
      })
      .controller('MainController', function ($scope, $http) {
        var buttonsHandler = new ButtonsHandler();

        $scope.renderButtons = function(){
          buttonsHandler.renderButtons();
        };

        $scope.buttons = buttonsHandler.buttons;
        $scope.breadcrumb =[];
        $scope.userBreadcrumb =[];

        $scope.clickGenius = function(buttonName){
          buttonsHandler.pressButton(buttonsHandler.buttons[buttonName]);
        };

        $scope.nextGenius = function(){
          var nextGeniusButton = buttonsHandler.getRandomButton();
          $scope.breadcrumb.push(nextGeniusButton);
          $scope.runGenius(0);

          $scope.userBreadcrumb = [];
        };

        $scope.runGenius = function(i){
          var INTERVAL_TIME = 400;

          window.setTimeout(function(){
            if(i <= $scope.breadcrumb.length - 1){
              $scope.runGenius(i + 1);
               var button = $scope.breadcrumb[i];
               button.soundClick.load();
               button.soundClick.play();
               buttonsHandler.lightButton(button);
            }
           
            
          }, INTERVAL_TIME);

        };

         function getRandomInt(min, max) {
          return Math.floor(Math.random() * (max - min + 1)) + min;
        }

      });
      
    </script>
  </body>
</html>