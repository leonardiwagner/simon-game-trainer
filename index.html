<html ng-app="angularApp">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="main.css" />
    <script src="https://code.jquery.com/jquery-1.11.2.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.13/angular.js"></script>
    <script src="underscore.js"></script>
  </head>
	<body ng-controller="MainController">
    <article >
      <div ng-repeat="item in breadcrumb track by $index" class="button-mini button-{{item}}"></div>
    </article>

    <article class="buttons-container">
      <div ng-repeat="button in buttons" class="button button-{{button.name}}" ng-click="clickGenius()"></div>
      <div id="score">{{breadcrumb.length}}</div>
    </article>


    <audio ng-repeat="button in buttons" id="sound-{{button.name}}" src="{{'sound-' + button.name + '.wav'}}" preload="auto"></audio>

    

    <a href ng-click="runGenius(0)">Run Genius</a>
    <a href ng-click="nextGenius()">Next Genius</a>
    <a href ng-click="pressButton()">Press Button</a>
    <script src="effects.js"></script>
    <script>
      var angularApp = angular.module('angularApp', []);
      angularApp.controller('MainController', function ($scope, $http) {
        var buttonsHandler = new ButtonsHandler();
        $scope.buttons = buttonsHandler.buttons;
        $scope.breadcrumb =[];
        $scope.userBreadcrumb =[];

        $scope.pressButton = function(){
          buttonsHandler.pressButton($(".button-red"));
        };

        $scope.nextGenius = function(){
          var nextGenius = $scope.buttons[getRandomInt(0, $scope.buttons.length - 1)];
          $scope.breadcrumb.push(nextGenius.name);
          $scope.runGenius(0);

          $scope.userBreadcrumb = [];
        };

        $scope.runGenius = function(i){
          $(".button").removeClass("on");
          $(".button.button-" + $scope.breadcrumb[i]).addClass("on");
          var audio = new Audio('sound-' + $scope.breadcrumb[i] + '.wav').play();

          $(".button-red").pressButton();

          window.setTimeout(function(){
            if(i < $scope.breadcrumb.length - 1){
              $scope.runGenius(i + 1);
            }else{
               $(".button").removeClass("on");
            }
           
            return;
          }, INTERVAL_TIME);

        };

         function getRandomInt(min, max) {
          return Math.floor(Math.random() * (max - min + 1)) + min;
        }

      });
      
    </script>
  </body>
</html>